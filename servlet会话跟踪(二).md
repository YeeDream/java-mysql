一.概述

会话技术：就是一次谈话，在web浏览器跟服务器的一次通信，那这次通信可以包含多次请求和多次响应

功能：在多次请求和多次响应间共享数据，记录信息确定用户身份

会话的结束标志：浏览器关闭，或者服务器关闭了代表这次会话就结束

分类：

   (1)客户端会话技术：数据由客户端来保存
    
   (2)服务端会话技术：数据由服务端来保存
  
二.客户端的会话技术-cookie
     
A.Cookie的由来
       
  HTTP的特点：Web应用程序是使用HTTP协议传输数据的，而HTTP协议是无状态的协议。一旦数据交换完毕，客户端与服务器端的连接就会关闭，再次交换数据需要建立新的连接，这就意味着服务器无法连接上跟踪回话。
 
  需求引出：用户A购买了一件商品放入购物车内，当再次购买商品时服务器已经无法判断该购买行为是属于A的会话还是属于用户B的会话了，要跟踪该会话，必须引入一种机制。

  即：一个用户的所有请求操作都应该属于同一个对话，而另一个用户的所有请求操作则应该属于另一个会话，二者不能混淆。
       
  说明：Cookie就是这样的一种机制，它就是为了弥补HTTP协议无状态的不足。
    
B.什么是Cookie?

Cookie意为“甜饼”，是由W3C组织提出，最早由Netscape社区发展的一种机制。目前Cookie已经成为标准，所有的主浏览器如：IE、Netscape、Firefox、Opera等都支持Cookie。  

C.Cookie的原理图
    
     
      
  说明：由于HTTP是一种无状态的协议，服务器单从网络连接上无从知道客户身份。给客户端们颁发一个通行证，每人一个，无论谁访问都必须携带自己的通行证，这样服务器就能从通行证上面确认客户身份。这就是cookie的工作原理。
    
  原理：
  ①客户端请求一个资源，服务器作出响应时，会发送set-cookie头
  ②客户端接收到响应，会将数据保存在客户端浏览器中
  ③客户端再一次请求服务器时，会通过cookie头携带该数据
  ④服务端接收到请求，会来解析获取数据

D.Cookie的分类
       
  Cookie分为会话cookie和持久cookie
       
  ①会话cookie:不设定它的生命周期，仅存活于当前会话中（浏览器的缓存中）；前面说了浏览器的开启到关闭就是一次会话，当关闭浏览器时，会话cookie就会跟随浏览器而销毁（HTTP的无状态所致）。当关闭一个页面时，不影响会话cookie的销毁。会话cookie就像我们没有办理积分卡时，单一的买卖过程，离开之后，信息则销毁。
       
  ②持久cookie:设定了它的生命周期，持久化（序列化）到硬盘中。此时cookie，有个保质期，关闭浏览器之后，它不会销毁，直到设定的过期时间。对于持久cookie,可以在同一个浏览器中传递数据，再次开启浏览器，依然会是登陆状态。这是因为cookie自动将数据传送到服务器端，再反馈回来的结果。持久cookie就像是我们办理了一张积分卡，即便离开，信息一直保留，直到时间到期，信息销毁。
      
  ③不同的浏览器采用不同的方式保存cookie。
     
E.Cookie需要注意的问题	
       
  ①cookie持久化问题
        
   默认浏览器会将cookie的数据包浏览器的内存当中，浏览器一关闭内存一释放，保存的数据就没了，那么我们肯定想要这个cookie数据保存在硬盘上，浏览器即便关了在存活期，下次请求还是能够带回来的，服务器可以设置cookie保存的位置以及周期。

  ②cookie不支持中文的解决办法

  ③cookie的键和值都是字符串类型
  
三.服务器端会话技术-session
   
  A.将数据存储在服务器端
   
  B.session实现原理
      
   原理：用户请求时，服务器首先创建session出来后，会把session的id号，以cookie的形式响应给客户端；这样只要客户机的浏览器不关，再去访问服务器时，都会带着session的id号，服务器发现客户机浏览器带session的id过来了，就会使用服务器内存中与之对应的session为之服务。
      
   具体：在打开浏览器第一次请求该jsp的时候，服务器会自动（理解为服务器对应的代码）为其创建一个session，并赋予其一个sessionID,发送给客户端的浏览器。以后客户端接着请求本应用中其它资源的时候，会自动在请求头上添加：Cookie:JSESSION=客户端第一次拿到的sessionID，这样服务器在接到请求时候，就会收到sessionID，并根据ID在浏览器的内存中找到之前创建的session对象，提供给请求使用。
      
   关键：session依赖于cookie存在。
   
  C.原理图
  


   解释：假如浏览器A先访问Servlet1，这时候它创建了一个Session，Jsessionid号为110，然后Servlet1(服务器)将这个Jsessionid号以Cookie的方式返回给浏览器A，接着如果浏览器A继续访问Servlet2，那么这个请求会带上Cookie值: JSESSIONID=110，然后服务器根据浏览器A(携带)传递过来的ID号找到内存中的这个Session。 这时候假如浏览器B来访问Servlet1了，它的请求并没有带上JSESSIONID这个Cookie值，由于它也要使用Session，所以服务器会新创建一个Session，JSESSIONID号为119，并将这个ID号以Cookie的方式返回给浏览器B,之后的过程就同A了。
           
   补充:用户第一次请求，服务器调用request.getSession()方法时，服务器会检查是否已经有对应的session，如果没有就在内存中创建一个session并返回给客户端该session的一个id以cookie保存，有的话就会在。
     
D.session的细节
    
   ①浏览器关闭了，再次请求session一样吗？
     
   答：不一样
   
   原因：浏览器关闭了（相当于会话结束），默认session仅存活于当前的会话中（如果没有将session持久化，保存的jsessionid没了），相当于创建了一个新的session。
      
   ②服务器关闭了，再次请求session1一样吗？
   
   答：不一样，会话结束，内存（缓存）释放，但是虽然对象不一样了，但是session中存储的数据还是一样。
     
E.session的生命周期。
      
   ①创建
    
    Request.getession():会根据jsessionid值查找是否存在session对象，如果没有找到则创建新的session
      
   ②销毁
   
    a.session超时
           超时：指的是连续一定时间服务器没有收到该session所对应的客户端的请求并且超过了服务器设置的session超市的最大时间。
    
    b.程序调用session.invalidate();--让session自杀
    
    c.服务器关闭或服务停止
    
    d.获取session：
           getSession(boolean flag)
           true:默认值，会根据sessionid值查找是否存在session对象，如果没找到，则创建新的session
           false:会根据sessionid值查找是否存在session对象，如果没找到，则返回null 
 
四.对比
   
  服务端会话技术：将数据保存在服务端，服务器压力大，数据安全

  客户端会话技术：cookie将数据保存客户端，服务器压力小，数据不安全